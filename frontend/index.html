<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeshVault</title>
    <link rel="stylesheet" href="/static/css/styles.css">

    <!-- Three.js from CDN via importmap -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
        }
    }
    </script>
</head>
<body>
    <!-- Top Bar: Asset name + export controls -->
    <header id="top-bar">
        <div class="top-bar-left">
            <div class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                <span>MeshVault</span>
            </div>
        </div>
        <div class="top-bar-center" id="asset-controls" style="display: none;">
            <div class="input-group">
                <label for="asset-name-input">Name:</label>
                <input type="text" id="asset-name-input" placeholder="asset_name" />
            </div>
            <div class="input-group">
                <label for="export-path-input">Export to:</label>
                <input type="text" id="export-path-input" placeholder="/path/to/export" />
            </div>
            <button id="btn-reset-view" class="btn btn-sm" title="Reset model to original state (undo Center/Ground/Orient/Scale)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="1 4 1 10 7 10"/>
                    <path d="M3.51 15a9 9 0 105.64-11.36L1 10"/>
                </svg>
                Reset
            </button>
            <span class="top-bar-sep"></span>
            <button id="btn-recenter" class="btn btn-sm" title="Center the model's bounding box at (0, 0, 0)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 2v4"/><path d="M12 18v4"/>
                    <path d="M2 12h4"/><path d="M18 12h4"/>
                </svg>
                Center
            </button>
            <button id="btn-ground" class="btn btn-sm" title="Center on X/Z and place the model on the ground (lowest point at Y=0)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="2" y1="20" x2="22" y2="20"/>
                    <path d="M12 16V4"/>
                    <polyline points="8 8 12 4 16 8"/>
                </svg>
                Ground
            </button>
            <button id="btn-auto-orient" class="btn btn-sm" title="Auto-orient the model so its up-vector aligns with Y (PCA)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
                Orient
            </button>
            <span class="top-bar-sep"></span>
            <button id="export-btn" class="btn btn-primary" title="Export asset (with modifications)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Export
            </button>
        </div>
        <div class="top-bar-right">
            <span id="status-text" class="status-text"></span>
        </div>
    </header>

    <!-- Main Layout -->
    <div id="main-layout">
        <!-- Left Sidebar: File Browser -->
        <aside id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title-row">
                    <h2>Files</h2>
                    <div class="sidebar-actions">
                        <button id="btn-view-list" class="btn btn-icon btn-xs active" title="List view">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/>
                                <line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
                            </svg>
                        </button>
                        <button id="btn-view-grid" class="btn btn-icon btn-xs" title="Grid view">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="path-bar">
                    <button id="btn-go-up" class="btn btn-icon" title="Go up">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                    </button>
                    <button id="btn-go-home" class="btn btn-icon" title="Go home">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                    <span id="current-path" class="current-path" title=""></span>
                </div>
                <input type="text" id="search-filter" class="search-input" placeholder="Filter files..." />
            </div>
            <div id="file-list" class="file-list">
                <!-- Populated dynamically -->
            </div>
        </aside>

        <!-- Resize handle -->
        <div id="sidebar-resize" class="sidebar-resize"></div>

        <!-- Main Content: 3D Viewer -->
        <main id="viewer-container">
            <div id="viewer-3d">
                <!-- Three.js canvas rendered here -->
            </div>
            <div id="viewer-placeholder">
                <div class="placeholder-content">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" opacity="0.3">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    <p>Select a 3D asset to preview</p>
                    <span class="hint">Supports .obj and .fbx files</span>
                    <span class="hint" style="margin-top: 16px; opacity: 0.5;">WASD to fly · Mouse to orbit · Space to reset</span>
                </div>
            </div>
            <!-- Loading overlay -->
            <div id="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <p>Loading asset...</p>
            </div>
            <!-- Viewer toolbar (top-right) -->
            <div id="viewer-toolbar">
                <!-- Nav mode toggle -->
                <button id="nav-mode-toggle" class="btn btn-icon viewer-tool-btn" title="Switch to FPV mode">
                    <svg id="nav-icon-orbit" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(-30 12 12)"/>
                    </svg>
                    <svg id="nav-icon-fpv" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
                        <path d="M22 2L11 13"/>
                        <path d="M22 2L15 22L11 13L2 9L22 2Z"/>
                    </svg>
                </button>
                <!-- Grid toggle -->
                <button id="grid-toggle" class="btn btn-icon viewer-tool-btn" title="Toggle grid">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18"/>
                        <line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/>
                        <line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/>
                    </svg>
                </button>
                <!-- Axis toggle -->
                <button id="axis-toggle" class="btn btn-icon viewer-tool-btn" title="Toggle axes (X/Y/Z)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke-width="2.5">
                        <line x1="4" y1="20" x2="20" y2="20" stroke="#ff4444"/>
                        <line x1="4" y1="20" x2="4" y2="4" stroke="#44dd44"/>
                        <line x1="4" y1="20" x2="12" y2="12" stroke="#4488ff"/>
                    </svg>
                </button>
                <!-- Wireframe toggle -->
                <button id="wireframe-toggle" class="btn btn-icon viewer-tool-btn" title="Toggle wireframe">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                        <line x1="12" y1="2" x2="12" y2="22" opacity="0.4"/>
                    </svg>
                </button>
                <!-- Light controls toggle -->
                <button id="light-toggle" class="btn btn-icon viewer-tool-btn" title="Light settings">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            </button>

            <!-- Light controls panel -->
            <div id="light-panel" class="light-panel" style="display: none;">
                <div class="light-panel-header">
                    <span>Lighting</span>
                </div>
                <div class="light-panel-body">
                    <div class="light-control">
                        <label>Direction</label>
                        <div class="slider-row">
                            <span class="slider-label">H</span>
                            <input type="range" id="light-azimuth" min="0" max="360" value="45" step="1" />
                            <span class="slider-value" id="light-azimuth-val">45°</span>
                        </div>
                        <div class="slider-row">
                            <span class="slider-label">V</span>
                            <input type="range" id="light-elevation" min="5" max="90" value="60" step="1" />
                            <span class="slider-value" id="light-elevation-val">60°</span>
                        </div>
                    </div>
                    <div class="light-control">
                        <label>Key Light</label>
                        <div class="slider-row">
                            <input type="range" id="light-key-intensity" min="0" max="3" value="1.2" step="0.05" />
                            <span class="slider-value" id="light-key-val">1.20</span>
                        </div>
                    </div>
                    <div class="light-control">
                        <label>Fill Light</label>
                        <div class="slider-row">
                            <input type="range" id="light-fill-intensity" min="0" max="2" value="0.5" step="0.05" />
                            <span class="slider-value" id="light-fill-val">0.50</span>
                        </div>
                    </div>
                    <div class="light-control">
                        <label>Ambient</label>
                        <div class="slider-row">
                            <input type="range" id="light-ambient-intensity" min="0" max="2" value="0.3" step="0.05" />
                            <span class="slider-value" id="light-ambient-val">0.30</span>
                        </div>
                    </div>
                    <div class="light-control">
                        <label>Exposure</label>
                        <div class="slider-row">
                            <input type="range" id="light-exposure" min="0.3" max="4" value="1.2" step="0.05" />
                            <span class="slider-value" id="light-exposure-val">1.20</span>
                        </div>
                    </div>
                    <button id="light-reset" class="btn btn-sm">Reset</button>
                </div>
            </div>
            </div><!-- end viewer-toolbar -->

            <!-- Scale control (bottom-right) -->
            <div id="scale-control" style="display: none;">
                <label for="model-scale">Scale</label>
                <input type="range" id="model-scale" min="0.25" max="2.0" value="1" step="0.25" list="scale-ticks" />
                <span id="model-scale-val">1.00×</span>
                <datalist id="scale-ticks">
                    <option value="0.25"></option>
                    <option value="0.5"></option>
                    <option value="0.75"></option>
                    <option value="1"></option>
                    <option value="1.25"></option>
                    <option value="1.5"></option>
                    <option value="1.75"></option>
                    <option value="2"></option>
                </datalist>
            </div>

            <!-- Background color swatches -->
            <div id="bg-swatches">
                <button class="bg-swatch active" data-color="#0d0d1a" title="Midnight" style="background:#0d0d1a;"></button>
                <button class="bg-swatch" data-color="#1a2332" title="Navy" style="background:#1a2332;"></button>
                <button class="bg-swatch" data-color="#2a2a2a" title="Charcoal" style="background:#2a2a2a;"></button>
                <button class="bg-swatch" data-color="#3d3d3d" title="Dark gray" style="background:#3d3d3d;"></button>
                <button class="bg-swatch" data-color="#5a5a5a" title="Gray" style="background:#5a5a5a;"></button>
                <button class="bg-swatch" data-color="#8a8a8a" title="Medium" style="background:#8a8a8a;"></button>
                <button class="bg-swatch" data-color="#b8b8b8" title="Silver" style="background:#b8b8b8;"></button>
                <button class="bg-swatch" data-color="#e0e0e0" title="Light" style="background:#e0e0e0;"></button>
                <button class="bg-swatch" data-color="#ffffff" title="White" style="background:#ffffff;"></button>
                <span class="bg-swatch-sep"></span>
                <button class="bg-swatch" data-color="#1a1a0d" title="Warm dark" style="background:#1a1a0d;"></button>
                <button class="bg-swatch" data-color="#2d1f1f" title="Dark red" style="background:#2d1f1f;"></button>
                <button class="bg-swatch" data-color="#1f2d1f" title="Dark green" style="background:#1f2d1f;"></button>
            </div>

            <!-- Viewer info -->
            <div id="viewer-info" style="display: none;">
                <span id="info-vertices">0 vertices</span>
                <span id="info-faces">0 faces</span>
                <span id="info-size">0 KB</span>
            </div>
        </main>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <!-- Main app script -->
    <script type="module" src="/static/js/app.js"></script>
</body>
</html>
